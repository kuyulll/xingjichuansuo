<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星空动画</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            height: 100vh;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="space"></canvas>
    <script>
        const canvas = document.getElementById("space");
        const c = canvas.getContext("2d");
        const raf = window.requestAnimationFrame;

        const cfg = {
            numStars: 10000,  
            focalLength: canvas.width * 2,
            mouseInfluence: 0.2,
            speed: 1,
            maxStarSizes: 5,
            fadeStarZ: 200,
            fadeEndZ: 100
        };

        let stars = [], cx, cy, mx = 0, my = 0;

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            cx = canvas.width / 2;
            cy = canvas.height / 2;

            stars = Array.from({ length: cfg.numStars }, () => ({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                z: Math.random() * canvas.width,
                o: '0.' + Math.floor(Math.random() * 99) + 1,
                px: 0,
                py: 0,
                pz: 0
            }));
        }

        function pos(x, y, z) {
            const scale = cfg.focalLength / z;
            return {
                x: (x - cx) * scale + cx,
                y: (y - cy) * scale + cy,
                size: Math.min(cfg.maxStarSizes, scale)
            };
        }

        function alpha(z) {
            if (z <= cfg.fadeStarZ) {
                return Math.max(0, Math.min(1, (z - cfg.fadeEndZ) / (cfg.fadeStarZ - cfg.fadeEndZ)));
            }
            return 1;
        }

        function mov() {
            stars.forEach(star => {
                [star.px, star.py, star.pz] = [star.x, star.y, star.z];
                star.z -= cfg.speed;
                star.x += mx * cfg.mouseInfluence / star.z;
                star.y += my * cfg.mouseInfluence / star.z;

                if (star.z <= cfg.fadeEndZ) {
                    star.z = canvas.width;
                    star.x = Math.random() * canvas.width;
                    star.y = Math.random() * canvas.height;
                    [star.px, star.py, star.pz] = [star.x, star.y, star.z];
                }
            });
        }

        function draw() {
            c.fillStyle = "rgb(0, 10, 20)";
            c.fillRect(0, 0, canvas.width, canvas.height);

            stars.forEach(star => {
                const curr = pos(star.x, star.y, star.z);
                const a = alpha(star.z);

                // 绘制星星
                c.beginPath();
                c.arc(curr.x, curr.y, curr.size * 0.5, 0, Math.PI * 2);
                c.fillStyle = `rgba(255, 255, 255, ${parseFloat(star.o) * a})`;
                c.fill();

                // 高速时绘制星轨
                if (cfg.speed > 10) {
                    const prev = pos(star.px, star.py, star.pz);
                    c.beginPath();
                    c.moveTo(prev.x, prev.y);
                    c.lineTo(curr.x, curr.y);
                    c.strokeStyle = `rgba(255, 255, 255, ${parseFloat(star.o) * a * 0.5})`;
                    c.lineWidth = curr.size * 0.3;
                    c.stroke();
                }
            });
        }

        function loop() {
            raf(loop);
            mov();
            draw();
        }

        // 事件监听
        window.addEventListener('resize', init);
        document.addEventListener('mousemove', e => {
            mx = e.clientX - cx;
            my = e.clientY - cy;
        });
        document.addEventListener('wheel', e => {
            cfg.speed = Math.max(0.1, Math.min(50, cfg.speed - e.deltaY * 0.05));
        });

        init();
        loop();
    </script>
</body>

</html>
